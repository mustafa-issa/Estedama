@using ChartsMix.Models
@model TableModel
<div>
    @using (Html.BeginForm("Index", "Home"))
    {
        <div class="jarviswidget-editbox">
            <div class="widget-body">
                <div class="row">
                    <div class="col-md-6 form-group">
                        @Html.EnumDropDownListFor(m => m.period, "Period", new { @class = "form-control", @id = "ddlTable" })
                    </div>
                </div>
                <div class="row" id="divDateTable" >
                    <div class="col-md-6 form-group">
                        @Html.EditorFor(m => m.From)
                    </div>
                    <div class="col-md-6 form-group">
                        @Html.EditorFor(m => m.To)
                    </div>

                </div>

                <div class="tree smart-form">
                    <ul>
                        @Html.Raw(Helpers.FormTreeView(Model.TreeRoot, "table"))
                    </ul>
                </div>
            </div>
            <input type="button" class="btn btn-default" value="Show Table Data" onclick="GetTable()" />
        </div>
    }
    <div class="widget-body">
        <table id="datatable_tabletools" class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th data-class="expand">Current Value</th>
                    <th data-class="expand">Previous Value</th>
                    <th data-class="expand">Consumption</th>
                    <th data-hide="phone,tablet">Date</th>
                </tr>
            </thead>
            <tbody>
               
            </tbody>
        </table>

    </div>

</div>

<script>
    function GetTable() {
        var model = {};
        model.From = dateFormat($('#tableModel_From').val());
        model.To = dateFormat($('#tableModel_To').val());
        model.Id = $('input[name=tableIds]:checked').val();
        debugger;
        model.Period = $('#ddlTable').val();
        model.Ids = [];
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetTable", "Home")',
            data: model,
            dataType: "json",
            traditional: true,
            success: function (data) {
                $('#datatable_tabletools tbody tr').remove();
                $.each(data.values, function (i, item) {
                    var rows = "<tr>" +
                        "<td class='EmployeeTableTD'>" + item.Value + "</td>" +
                        "<td class='EmployeeTableTD'>" + item.PreviousValue + "</td>" +
                        "<td class='EmployeeTableTD'>" + item.Consumption + "</td>" +
                        "<td class='EmployeeTableTD'>" + item.Date + "</td>" +
                        "</tr>";
                    $('#datatable_tabletools').append(rows);
                });

                $('#datatable_tabletools').dataTable({
                    "sDom": "<'dt-toolbar'<'col-sm-6 col-xs-6 hidden-xs'T>r>" +
                            "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-sm-6 col-xs-12'p>>",
                    "oTableTools": {
                        "aButtons": [
                        {
                            "sExtends": "xls",
                            "sTitle": "ChartsMix",
                            "sPdfMessage": "ChartsMix Excel Export",
                            "sPdfSize": "A4"
                        },
                           {
                               "sExtends": "pdf",
                               "sTitle": "ChartsMix",
                               "sPdfMessage": "ChartsMix PDF Export",
                               "sPdfSize": "A4"
                           },
                           {
                               "sExtends": "print",
                               "sMessage": "Generated by ChartsMix <i>(press Esc to close)</i>"
                           }
                        ],
                        "sSwfPath": "/Scripts/plugin/datatables/swf/copy_csv_xls_pdf.swf"
                    },
                    "autoWidth": true
                });
            },
            error: function (err) {
                alert('error');
            }
        });
    }
</script>